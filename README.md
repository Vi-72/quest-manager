# Quest Manager Service

HTTP-—Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞–º–∏.


## üîß –ó–∞–ø—É—Å–∫

### üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.23+
- PostgreSQL

### üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp config.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –ø–æ–¥ –≤–∞—à—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```

2. **–ó–∞–ø—É—Å–∫:**
```bash
go run ./cmd/app
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É, —É–∫–∞–∑–∞–Ω–Ω–æ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `HTTP_PORT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080).

### üåê API Endpoints

- `GET /api/v1/quests` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–≤–µ—Å—Ç–æ–≤
- `POST /api/v1/quests` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–≤–µ—Å—Ç–∞
- `GET /api/v1/quests/{quest_id}` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞ –ø–æ ID
- `PATCH /api/v1/quests/{quest_id}/status` - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–≤–µ—Å—Ç–∞
- `POST /api/v1/quests/{quest_id}/assign` - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `GET /api/v1/quests/assigned?user_id={id}` - –ö–≤–µ—Å—Ç—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `GET /api/v1/quests/search-radius` - –ü–æ–∏—Å–∫ –∫–≤–µ—Å—Ç–æ–≤ –ø–æ —Ä–∞–¥–∏—É—Å—É

### üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- Swagger UI: `http://localhost:8080/docs`
- OpenAPI JSON: `http://localhost:8080/openapi.json`

### üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
quest-manager/
‚îú‚îÄ‚îÄ cmd/                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ app/                # –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ composition_root.go # DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ config.go           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ adapters/           # –ê–¥–∞–ø—Ç–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ in/http/        # HTTP handlers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ out/postgres/   # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ core/               # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application/    # Use cases
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/         # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ports/          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ generated/          # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îî‚îÄ‚îÄ pkg/                # –û–±—â–∏–µ –ø–∞–∫–µ—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ validations/    # –°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ api/openapi/            # OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îî‚îÄ‚îÄ configs/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```

### üéØ –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

**Quest (–ö–≤–µ—Å—Ç)**
- ID, Title, Description
- Difficulty (easy/medium/hard)
- Status (created/posted/assigned/in_progress/declined/completed)
- Target/Execution Location (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
- Equipment, Skills (—Å–ø–∏—Å–∫–∏)
- Creator, Assignee
- Timestamps

**GeoCoordinate (–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)**
- Latitude, Longitude
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
- –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è (Haversine formula)

## üîç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**:

### üìù –£—Ä–æ–≤–Ω–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** (`internal/pkg/validations/`)
   - –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (–Ω–µ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)
   - –°–∏–Ω—Ç–∞–∫—Å–∏—Å (UUID —Ñ–æ—Ä–º–∞—Ç, —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ä–∞–∑–º–µ—Ä—ã –ø–æ–ª–µ–π, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã)

2. **–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞** (–¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ enum –∑–Ω–∞—á–µ–Ω–∏—è–º (difficulty: easy/medium/hard)
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
   - –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```
internal/pkg/validations/
‚îú‚îÄ‚îÄ common.go           # –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –∏ –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ coordinates.go      # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
‚îú‚îÄ‚îÄ create_quest.go     # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–∞  
‚îî‚îÄ‚îÄ assign_quest.go     # –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞
```

### üîÑ –ü—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```go
// 1. HTTP Layer - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
validatedData, err := validations.ValidateCreateQuestRequest(request.Body)

// 2. Domain Layer - –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
quest, err := quest.NewQuest(
    validatedData.Title,
    validatedData.Description, 
    validatedData.Difficulty, // —Å—Ç—Ä–æ–∫–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤ –¥–æ–º–µ–Ω–µ
    // ...
)
```

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è vs –±–∏–∑–Ω–µ—Å –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `common.go`
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —É—Ä–æ–≤–Ω–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **–î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏**: RFC 7807 Problem Details
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ

### üìã –ü—Ä–∏–º–µ—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```json
// –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
{
  "type": "bad-request",
  "title": "Bad Request", 
  "status": 400,
  "detail": "validation failed: field 'title' is required and cannot be empty"
}

// –ë–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∞
{
  "type": "bad-request",
  "title": "Bad Request",
  "status": 400, 
  "detail": "invalid difficulty: must be one of 'easy', 'medium', 'hard'"
}
```

## üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

–î–ª—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ OpenAPI:
```bash
oapi-codegen -config configs/server.cfg.yaml api/openapi/openapi.yml
```

## üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- [Chi Router](https://github.com/go-chi/chi) - HTTP —Ä–æ—É—Ç–µ—Ä
- [GORM](https://gorm.io/) - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- [oapi-codegen](https://github.com/oapi-codegen/oapi-codegen) - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –∏–∑ OpenAPI
- [UUID](https://github.com/google/uuid) - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
go test ./...
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture:
- **Domain Layer**: –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
- **Application Layer**: Use cases –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- **Infrastructure Layer**: –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
- **Ports & Adapters**: –ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π