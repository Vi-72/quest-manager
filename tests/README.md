# Tests Directory

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ Quest Manager, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —É—Ä–æ–≤–Ω—è–º –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ domain/                    # üèóÔ∏è –î–æ–º–µ–Ω–Ω—ã–µ (unit) —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ quest_test.go          # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏ Quest
‚îÇ   ‚îú‚îÄ‚îÄ location_test.go       # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏ Location
‚îÇ   ‚îú‚îÄ‚îÄ assign_quest_test.go   # –¢–µ—Å—Ç—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ contracts/                 # ü§ù –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ mocks/                 # Mock —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ *_contracts_test.go    # –¢–µ—Å—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
‚îú‚îÄ‚îÄ integration/               # üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ tests/                 # –ì—Ä—É–ø–ø—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quest_e2e_tests/   # E2E —Ç–µ—Å—Ç—ã –∫–≤–µ—Å—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quest_http_tests/  # HTTP API —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quest_handler_tests/ # Handler —Å–ª–æ–π —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository_tests/  # Repository —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ core/                  # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assertions/        # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ case_steps/        # –®–∞–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage/           # –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_data_generators/ # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ README.md             # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ pkg/                      # üì¶ –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
    ‚îî‚îÄ‚îÄ errs/                 # –¢–µ—Å—Ç—ã –ø–∞–∫–µ—Ç–∞ –æ—à–∏–±–æ–∫
```

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. **Domain Tests** (`tests/domain/`)
**Unit —Ç–µ—Å—Ç—ã –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏**
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É—é—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–º–µ–Ω–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—é, –∞–≥—Ä–µ–≥–∞—Ç—ã

```bash
# –ó–∞–ø—É—Å–∫ –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
make test-unit
# –∏–ª–∏
go test ./tests/domain -v
```

### 2. **Contract Tests** (`tests/contracts/`)
**–¢–µ—Å—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç mock –æ–±—ä–µ–∫—Ç—ã
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø–æ—Ä—Ç—ãapplication —Å–ª–æ—è

```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤  
go test ./tests/contracts -v
```

### 3. **Integration Tests** (`tests/integration/`)
**–¢–µ—Å—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
- ‚úÖ –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- ‚úÖ HTTP API —Ç–µ—Å—Ç—ã
- ‚úÖ Repository —Å–ª–æ–π —Ç–µ—Å—Ç—ã
- ‚úÖ Handler –∏ use case —Ç–µ—Å—Ç—ã
- ‚úÖ E2E —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
make test-integration
# –∏–ª–∏
go test -tags=integration ./tests/integration/... -v

# –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø
go test -tags=integration ./tests/integration/tests/quest_http_tests -v
go test -tags=integration ./tests/integration/tests/repository_tests -v
```

### 4. **Package Tests** (`tests/pkg/`)
**–¢–µ—Å—Ç—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤**
- ‚úÖ –¢–µ—Å—Ç—ã error handling
- ‚úÖ –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
make test-all           # –í—Å–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤
make test              # Unit + integration
```

### –ó–∞–ø—É—Å–∫ –ø–æ —Ç–∏–ø–∞–º
```bash
make test-unit         # –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä–æ)
make test-integration  # –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
make test-repository   # –¢–æ–ª—å–∫–æ repository —Ç–µ—Å—Ç—ã
```

### –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è
```bash
make coverage-check    # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è internal/ –∫–æ–¥–∞
make coverage-report   # –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è
make test-coverage     # –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤
```bash
make test-stats        # –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ç–µ—Å—Ç–∞–º
make test-stats-new    # –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –î–ª—è Unit —Ç–µ—Å—Ç–æ–≤
- Go 1.21+
- –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –î–ª—è Integration —Ç–µ—Å—Ç–æ–≤
- PostgreSQL (—á–µ—Ä–µ–∑ Docker Compose)
- Build tag: `-tags=integration`

```bash
# –ó–∞–ø—É—Å–∫ PostgreSQL
docker compose up -d postgres

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
docker exec -it quest-manager-postgres-1 psql -U postgres -c "CREATE DATABASE quest_manager_test;"
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–¶–µ–ª—å: **>80%** –ø–æ–∫—Ä—ã—Ç–∏—è –¥–ª—è `internal/` –∫–æ–¥–∞

- ‚úÖ **Domain layer**: >90% (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞)
- ‚úÖ **Application layer**: >85% (use cases –∏ –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ **Adapters layer**: >70% (HTTP handlers, repositories)

–ò—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è:
- `tests/` –ø–∞–ø–∫–∏
- `cmd/` main —Ñ—É–Ω–∫—Ü–∏–∏
- Generated –∫–æ–¥

## üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### Unit —Ç–µ—Å—Ç—ã
1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `tests/domain/` —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `_test.go`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã –∏–∑ `internal/`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `testify/assert` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫

### Integration —Ç–µ—Å—Ç—ã
1. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –≤ `tests/integration/tests/`
2. –î–æ–±–∞–≤—å—Ç–µ build tag `//go:build integration`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `core/`
4. –ù–∞—Å–ª–µ–¥—É–π—Ç–µ—Å—å –æ—Ç –±–∞–∑–æ–≤—ã—Ö test suites

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [Integration Tests README](integration/README.md)

## üéØ Best Practices

1. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: `TestFunction_Scenario_ExpectedResult`
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**: Arrange ‚Üí Act ‚Üí Assert
3. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
4. **–î–∞–Ω–Ω—ã–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∏–∑ `test_data_generators/`
5. **–°–∫–æ—Ä–æ—Å—Ç—å**: Unit —Ç–µ—Å—Ç—ã < 100ms, Integration < 1s
6. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –¢–µ—Å—Ç—ã –∫–∞–∫ –∂–∏–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìà CI/CD

–í—Å–µ —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏:
- Pull requests
- Push –≤ main –≤–µ—Ç–∫—É
- Nightly builds –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–∫—Ä—ã—Ç–∏—è

–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ README –ø—Ä–æ–µ–∫—Ç–∞.